<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>New Tab</title>
<style>
body{
    background-color:var(--background-color, #000);
    display:flex;
    justify-content: end;
    align-items: end;
}
</style>
<input type="color" id="picker" value="#43464e">
<script >
    const KEY = "background-color";
    const picker = document.getElementById('picker')

    async function getSavedBackgroundColor() {
        return await chrome.storage.sync.get(KEY)
    }

    async function saveBackgroundColor(color) {
        await chrome.storage.sync.get({ [KEY]: color })
    }

    function setBackgroundColorVariable(color) {
        document.body.style.setProperty('--background-color', color)
    }

    chrome.storage.onChanged.addListener((changes, area) => {
        if (area === 'sync' && changes[KEY]) {
            setBackgroundColorVariable(changes[KEY].newValue)
        }
    });

    addEventListener('storage', ({ key, newValue }) => {
        if (key === KEY) {
            setBackgroundColorVariable(newValue)
        }
    })

    picker.addEventListener('input', (event) => {
        setBackgroundColorVariable(event.target.value)
    })

    picker.addEventListener('change', (event) => {
        saveBackgroundColor(event.target.value)
    })

    setBackgroundColorVariable(getSavedBackgroundColor())
</script>
